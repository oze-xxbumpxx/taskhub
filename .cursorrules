# コーディング規約

このファイルは、バックエンド（Node.js + TypeScript）とフロントエンド（React + TypeScript）の両方のコーディング規約を定義します。

## 基本原則

- **型安全性**: `any`型の使用を避け、適切な型定義を行う
- **保守性**: 単一責任の原則に従い、関数・コンポーネントを適切に分割
- **可読性**: 早期リターン、ガード句を使用してネストを浅くする
- **エラーハンドリング**: エラーを適切に処理し、ログ出力する

---

## バックエンド規約（共通）

### ❌ 避けるべき実装パターン

1. **`any`型の使用禁止**
   - `any`型は使用禁止。`unknown`型を使用し、型ガードで絞り込む

2. **型アサーション（`as`）の多用禁止**
   - `as any`、`as User`などの多用は禁止
   - 型ガードやZodなどのバリデーションライブラリを使用

3. **Non-null assertion (`!`)の使用禁止**
   - `config.jwt.secret!`などの使用は禁止
   - 明示的なnullチェックを行う

4. **型定義のコピペ禁止**
   - 型定義をコピペせず、再利用可能な型を定義

5. **二重アサーション禁止**
   - `as unknown as T`などの使用は禁止

6. **マジックナンバー/マジックストリング禁止**
   - 数値や文字列を直接コードに書かず、定数として定義

7. **深いネスト（3階層以上）禁止**
   - 早期リターンやガード句を使用

8. **長すぎる関数（50行超）禁止**
   - 単一責任の原則に従い、関数を分割

9. **ハードコードされた値禁止**
   - 環境変数や設定ファイル（Zodスキーマなど）を使用

10. **`console.log`の直接使用禁止**
    - プロジェクトの`logger`を使用

11. **エラーハンドリングの不備禁止**
    - `unknown`型で受け取り、型ガードで絞り込む
    - エラーを無視せず、適切に処理・ログ出力

---

## フロントエンド規約（React + TypeScript）

### 型安全性

- **`any`型の使用禁止**: Props、状態、イベントハンドラーに適切な型を定義
- **型アサーション（`as`）の多用禁止**: 型ガードやZodを使用
- **Non-null assertion (`!`)の使用禁止**: 明示的なnullチェックを行う
- **Propsの型定義必須**: `interface`でPropsを定義
- **イベントハンドラーの型定義必須**: `React.MouseEvent<HTMLButtonElement>`など

### コンポーネント設計

- **巨大なコンポーネント禁止**: 200行超は分割
- **プレゼンテーショナル/コンテナ分離**: データ取得と表示ロジックを分離
- **インラインスタイルの多用禁止**: CSS Modulesやstyled-componentsを使用
- **マジックナンバー/マジックストリング禁止**: 定数として定義

### フック（Hooks）

- **条件分岐内でのフック呼び出し禁止**: Reactのルールに違反
- **カスタムフックは`use`で始める**: `useUserData`など
- **`useEffect`の依存配列を適切に設定**: ESLintの`exhaustive-deps`ルールを有効化
- **高コストな計算は初期化関数または`useMemo`を使用**

### 状態管理

- **不要な状態管理禁止**: 計算可能な値は`useMemo`を使用
- **状態の持ち上げ**: 複数コンポーネントで共有する状態は親コンポーネントに
- **グローバル状態の乱用禁止**: 必要な場合のみ使用（認証情報、ユーザー情報など）

### パフォーマンス

- **インライン関数の多用禁止**: `useCallback`を適切に使用
- **不要な再レンダリング回避**: `React.memo`、`useMemo`を適切に使用
- **`useMemo`/`useCallback`の過剰使用禁止**: 必要な場合のみ使用

### フォーム処理

- **制御コンポーネント（controlled components）を使用**: `useState`で状態管理
- **バリデーション実装**: Zod + react-hook-form推奨

### API通信

- **`fetch`の直接使用禁止**: APIクライアント関数を作成
- **エラーハンドリング実装**: `try-catch`で適切に処理
- **React QueryやSWRの使用推奨**: より高度な状態管理

### エラーハンドリング

- **エラーバウンダリ実装**: `ErrorBoundary`コンポーネントを作成
- **エラーを無視しない**: 適切に処理・ログ出力

### アクセシビリティ

- **セマンティックHTML使用**: `<nav>`、`<main>`、`<article>`など
- **ARIA属性の適切な設定**: `role`、`aria-label`など

### ファイル構成・命名

- **コンポーネント名**: PascalCase（`UserCard.tsx`）
- **変数・関数名**: camelCase（`getUser`、`userName`）
- **定数**: UPPER_SNAKE_CASE（`MAX_LENGTH`、`API_URL`）
- **カスタムフック**: `use`で始める（`useUserData`）

### スタイリング

- **CSS Modulesまたはstyled-components使用**: インラインスタイルの多用禁止
- **クラス名のマジックストリング禁止**: `clsx`や`classnames`を使用

---

## 実装チェックリスト

### バックエンド
- [ ] `as any`を使用していない
- [ ] `as`型アサーションは最小限で、型ガードやバリデーションで代替できないか検討した
- [ ] `any`型を使用していない（`unknown`を使用し、型ガードで絞り込んでいる）
- [ ] Non-null assertion (`!`)を使用していない（明示的なnullチェックを行っている）
- [ ] 型定義をコピペせず、再利用可能な型を定義している
- [ ] `as const`は適切な場面でのみ使用している
- [ ] ライブラリの型をそのまま使わず、必要に応じてドメイン型に変換している
- [ ] 二重アサーション（`as unknown as T`など）を使用していない
- [ ] マジックナンバー/マジックストリングを使用せず、定数として定義している
- [ ] 深いネスト（3階層以上）を避け、早期リターンを使用している
- [ ] 関数が50行を超えないように分割している（単一責任の原則）
- [ ] ハードコードされた値を避け、環境変数や設定ファイルを使用している
- [ ] `console.log`の直接使用を避け、`logger`を使用している
- [ ] エラーハンドリングで`unknown`型を使用し、型ガードで絞り込んでいる
- [ ] エラーを無視せず、適切に処理・ログ出力している
- [ ] 関数の引数と戻り値の型が明示されている

### フロントエンド
- [ ] `any`型を使用していない
- [ ] `as`型アサーションは最小限で、型ガードやバリデーションで代替できないか検討した
- [ ] Non-null assertion (`!`)を使用していない（明示的なnullチェックを行っている）
- [ ] Propsの型定義が明示されている
- [ ] イベントハンドラーの型が明示されている
- [ ] コンポーネントが200行を超えないように分割している
- [ ] プレゼンテーショナルコンポーネントとコンテナコンポーネントを分離している
- [ ] インラインスタイルを多用していない（CSS Modulesやstyled-componentsを使用）
- [ ] 条件分岐内でフックを呼び出していない
- [ ] カスタムフックは`use`で始まる名前になっている
- [ ] `useEffect`の依存配列を適切に設定している
- [ ] 高コストな計算は`useState`の初期化関数または`useMemo`を使用している
- [ ] 計算可能な値を状態として保持していない
- [ ] 複数のコンポーネントで共有する状態は適切に持ち上げている
- [ ] グローバル状態は必要な場合のみ使用している
- [ ] インライン関数の多用を避け、`useCallback`を適切に使用している
- [ ] 不要な再レンダリングを避けている（`React.memo`、`useMemo`を適切に使用）
- [ ] `useMemo`/`useCallback`を過剰に使用していない
- [ ] 制御コンポーネント（controlled components）を使用している
- [ ] バリデーションを適切に実装している
- [ ] `fetch`を直接使用せず、APIクライアント関数を作成している
- [ ] エラーハンドリングを適切に実装している
- [ ] エラーバウンダリを実装している
- [ ] セマンティックなHTML要素を使用している
- [ ] 必要な場合にARIA属性を適切に設定している
- [ ] マジックナンバー/マジックストリングを使用せず、定数として定義している
- [ ] ファイル名の命名規則に従っている
- [ ] コンポーネント名はPascalCase、変数・関数名はcamelCaseを使用している
- [ ] 不要なコメントを書いていない（「なぜ」を説明するコメントのみ）
- [ ] 複雑なロジックにはコメントを書いている

---

## コードレビュー時の重点チェック項目

1. **型安全性**: `any`型、型アサーション、Non-null assertionの使用
2. **単一責任の原則**: 関数・コンポーネントの長さと責任
3. **エラーハンドリング**: 適切なエラー処理とログ出力
4. **パフォーマンス**: 不要な再レンダリング、メモ化の適切な使用
5. **保守性**: マジックナンバー/マジックストリング、ハードコードされた値
6. **アクセシビリティ**: セマンティックHTML、ARIA属性

---

詳細な規約は以下のファイルを参照してください：
- バックエンド規約: ワークスペースルール（always_applied_workspace_rules）
- フロントエンド規約: `FRONTEND_CODING_STANDARDS.md`
